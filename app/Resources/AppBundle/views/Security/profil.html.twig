{% extends "::base.html.twig" %}

{% block breadcrumb_items %}
    <li><span>Mon profil</span></li>
{% endblock %}

{% block body %}

<div class="row">

    <!-- BEGIN MAIN CONTENT -->
    <div class="main col-sm-8 col-sm-offset-2">
        <h1 class="section-title">Mon profil</h1>
        <center>
            <p>
                Vous pouvez dès à présent rechercher une offre, mais nous vous invitons à compléter votre profil.
                <br />
                Un profil complet est indispensable pour pouvoir répondre à une offre.
                <br />
                Voir les <a href="{{ path('cgu') }}">Conditions générales d'utilisation</a>
            </p>
        </center>
    </div>

</div>

<div id="js-form-space">
    {{ form_start(form, {'attr': {'class': 'has-crosses'}}) }}
    <div class="row">
        <div class="main col-sm-8 col-sm-offset-2">
            <h1 class="section-title">
              <i class="icon user-red-bold"></i>
              Mes informations
            </h1>

            <div class="form-contener">
                <div class="row">
                    <div class="col-sm-6 inline-controls form-group civility-group">
                        {{ form_label(form.civility) }}
                        {{ form_widget(form.civility, { 'label_attr': { 'class': 'radio-inline' } }) }}
                        {{ form_errors(form.civility) }}
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-6 form-group">
                        {{ form_row(form.firstname) }}
                    </div>
                    <div class="col-sm-6 form-group">
                        {{ form_row(form.lastname) }}
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-6 form-group">
                        {{ form_row(form.birthday) }}
                    </div>
                    <div class="col-sm-6 form-group">
                        {{ form_row(form.phone) }}
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-6 form-group">
                        {{ form_row(form.email) }}
                    </div>
                    <div class="col-sm-6 form-group">
                        {{ form_row(form.password) }}
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-12 form-group">
                        {{ form_row(form.description) }}
                    </div>
                </div>
                <div class="row form-group form-group">
                    <div class="col-sm-10 col-sm-offset-2">
                        {{ form_row(form.newsletter) }}
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-4 col-sm-offset-4">
                        <input type="submit" value="Enregistrer" class="btn btn-fullcolor form-control">
                    </div>
                </div>
            </div>

            <h1 class="section-title">
              <i class="icon struct-red-bold"></i>
              Ma structure
            </h1>

            <div class="form-contener">
                <div class="row">
                    <div class="col-sm-6 form-group">
                        {{ form_row(form.company) }}
                    </div>
                    <div class="col-sm-6 form-group">
                        {{ form_row(form.companyStatus) }}
                    </div>
                </div>

                <div class="row">
                    <div class="col-sm-6  form-group">
                        {{ form_row(form.companyCreationDate) }}
                    </div>
                    <div class="col-sm-6  form-group">
                        {{ form_row(form.siret)}}
                    </div>
                </div>

                <div class="row">
                    <div class="col-sm-6 form-group">
                        {{ form_row(form.address)}}
                    </div>
                    <div class="col-sm-6 form-group">
                        {{ form_row(form.addressSuite) }}
                    </div>
                </div>

                <div class="row">
                    <div class="col-sm-6 form-group">
                        {{ form_row(form.zipcode) }}
                    </div>
                    <div class="col-sm-6 form-group">
                        {{ form_row(form.city)}}
                    </div>
                </div>

                <div class="row">
                    <div class="col-sm-6 form-group">
                        {{ form_row(form.companyPhone)}}
                    </div>
                    <div class="col-sm-6 form-group">
                        {{ form_row(form.companyMobile) }}
                    </div>
                </div>

                <div class="row">
                   <div class="col-sm-12 form-group">
                        {{ form_row(form.companyDescription)}}
                   </div>
                </div>

                <div class="row">
                    <div class="col-sm-6 form-group">
                        {{ form_row(form.companyEffective)}}
                    </div>
                    <div class="col-sm-6 form-group">
                        {{ form_row(form.companyStructures)}}
                    </div>
                </div>

                <div class="row form-group" >
                    <div class="col-sm-6 form-group">
                        {{ form_row(form.companySite)}}
                    </div>
                    <div class="col-sm-6 form-group">
                        {{ form_row(form.companyBlog)}}
                    </div>
                </div>

                <div class="row">
                    <div class="col-sm-4 col-sm-offset-4">
                        <input type="submit" value="Enregistrer" class="btn btn-fullcolor form-control">
                    </div>
                </div>
            </div>

            <h1 class="section-title">
              <i class="icon list-red-bold"></i>
              Mes souhaits
            </h1>

            <div class="form-contener">
                <div class="row" >
                    <div class="col-sm-6 form-group">
                        {{ form_row(form.wishedSize)}}
                    </div>
                    <div class="col-sm-6 form-group">
                        {{ form_row(form.useType)}}
                    </div>
                </div>

                <div class="row" >
                    <div class="col-sm-6 form-group">
                        {{ form_row(form.usageDate)}}
                    </div>
                    <div class="col-sm-6 form-group {% if form.usageDuration.vars.errors|length %}has-error{% endif %}">
                        {{ form_label(form.usageDuration)}}<br />
                        <div class="row">
                          <div class="col-sm-5">
                            {{ form_widget(form.usageDuration) }}
                          </div>
                          <div class="col-sm-7">
                            {{ form_widget(form.lengthTypeOccupation) }}
                          </div>
                        </div>
                        {{ form_errors(form.usageDuration) }}
                    </div>
                </div>

                <div class="row form-group">
                    <div class="col-sm-12 form-group">
                        {{ form_row(form.projectDescription)}}
                    </div>
                </div>

                <div class="row">
                    <div class="col-sm-4 col-sm-offset-4">
                        <input type="submit" value="Enregistrer" class="btn btn-fullcolor form-control">
                    </div>
                </div>
            </div>

            <h1 class="section-title">
              <i class="icon soc-red-bold"></i>
              Réseaux sociaux
            </h1>

            <div class="form-contener">
                <div class="row" >
                    <div class="col-sm-6 form-group">
                      <div class="input-group social-group">
                        <span class="input-group-addon"><i class="fa fa-facebook"></i></span>
                        {{ form_widget(form.facebookUrl) }}
                        {{ form_errors(form.facebookUrl) }}
                      </div>
                    </div>
                    <div class="col-sm-6 form-group">
                      <div class="input-group social-group">
                        <span class="input-group-addon"><i class="fa fa-google-plus"></i></span>
                        {{ form_widget(form.googleUrl) }}
                        {{ form_errors(form.googleUrl) }}
                      </div>
                    </div>
                </div>

                <div class="row" >
                    <div class="col-sm-6 form-group">
                      <div class="input-group social-group">
                        <span class="input-group-addon"><i class="fa fa-twitter"></i></span>
                        {{ form_widget(form.twitterUrl) }}
                        {{ form_errors(form.twitterUrl) }}
                      </div>
                    </div>
                    <div class="col-sm-6 form-group">
                      <div class="input-group social-group">
                        <span class="input-group-addon"><i class="fa fa-linkedin"></i></span>
                        {{ form_widget(form.linkedinUrl) }}
                        {{ form_errors(form.linkedinUrl) }}
                      </div>
                    </div>
                </div>

                <div class="row" >
                    <div class="col-sm-6 form-group">
                      <div class="input-group social-group">
                        <span class="input-group-addon"><i class="fa fa-instagram"></i></span>
                          {{ form_widget(form.instagramUrl) }}
                          {{ form_errors(form.instagramUrl) }}
                      </div>
                    </div>
                    <div class="col-sm-6 form-group">
                        <div class="input-group social-group">
                            <span class="input-group-addon"><i class="socicon-viadeo"></i></span>
                              {{ form_widget(form.otherUrl) }}
                              {{ form_errors(form.otherUrl) }}
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-sm-4 col-sm-offset-4">
                        <input type="submit" value="Enregistrer" class="btn btn-fullcolor form-control">
                    </div>
                </div>

            </div>

            <h1 class="section-title">
              <i class="icon doc-red-bold"></i>
              Documents
            </h1>

            <div class="form-contener">

          <div class="row">
            <div class="col-sm-5 required-files">
              <ul class="list-unstyled">
                <li class="idcard-file">
                  {% if app.user.hasDocuments('id') %}
                      <i class="fa fa-check"></i>
                  {% else %}
                      <i class="fa fa-times"></i>
                  {% endif %}
                  <label class="required">Pièce d'identité</label>
                </li>

                <li class="kbis-file">
                  {% if app.user.hasDocuments('kbis') %}
                      <i class="fa fa-check"></i>
                  {% else %}
                      <i class="fa fa-times"></i>
                  {% endif %}
                  <label class="required">Kbis</label>
                </li>
              </ul>
            </div>

                <div class="col-sm-7">

                  <label class="control-label bold">Mes téléchargements</label>

                  <dl class="dl-horizontal info-block">
                    <dt><i class="fa fa-info-circle"></i></dt>
                    <dd>
                      Les documents suivants seront attachés à toutes vos candidatures.
                      Les fichiers complémentaires qui peuvent être joints dans toutes vos candidatures
                      doivent être téléchargés à partir de chaque fiche projet.
                    </dd>
                  </dl>

              <div class="files">
                {{ form_errors(form.idcard) }}
                <div class="idcard-file file-infos {% if not form.idcard.vars.valid %}has-error{% endif %}">
                  <span>Pièce d'identité</span>
                  <div class="pull-right actions">
                    <label class="custom-file-input btn btn-accepted">
                        {{ form_widget(form.idcard) }}
                        <i class="fa fa-upload"></i>
                    </label>
                    {% if app.user.hasDocuments('id') %}
                        {% set file =  app.user.getDocumentsType('id')[0] %}
                        <a target="_blank" href="{{ asset(vich_uploader_asset(file, 'file')) }}" class="btn btn-show"><i class="fa fa-search"></i></a>
                        <a href="{{ path('profile_removedocument', { 'id': file.id }) }}" class="btn btn-delete"><i class="fa fa-trash"></i></a>
                    {% endif %}
                  </div>
                  {{ form_errors(form.idcard) }}
                </div>

                <div class="kbis-file file-infos {% if not form.kbis.vars.valid %}has-error{% endif %}">
                  <span>Kbis</span>
                  <div class="pull-right actions">
                    <label class="custom-file-input btn btn-accepted">
                        {{ form_widget(form.kbis) }}
                        <i class="fa fa-upload"></i>
                    </label>
                    {% if app.user.hasDocuments('kbis') %}
                        {% set file =  app.user.getDocumentsType('kbis')[0] %}
                        <a target="_blank" href="{{ asset(vich_uploader_asset(file, 'file')) }}" class="btn btn-show"><i class="fa fa-search"></i></a>
                        <a href="{{ path('profile_removedocument', { 'id': file.id }) }}" class="btn btn-delete"><i class="fa fa-trash"></i></a>
                    {% endif %}
                  </div>
                  {{ form_errors(form.kbis) }}
                </div>

                <hr />

                {% for doc in form.vars.data.getDocumentsType('') %}
                    <div class="file-infos">
                      <span>{{doc.fileName | slice(14, 100)}}</span>
                      <div class="pull-right actions">
                          <a target="_blank" href="{{ asset(vich_uploader_asset(doc, 'file')) }}" class="btn btn-show"><i class="fa fa-search"></i></a>
                          <a href="{{ path('profile_removedocument', { 'id': doc.id }) }}" class="btn btn-delete"><i class="fa fa-trash"></i></a>
                      </div>
                    </div>
                {% endfor %}

              </div>

              <div class="add-file">
                <h4>
                  <i class="icon small icon-inline add-red"></i>
                  Ajouter un fichier
                </h4>

                    <dl class="dl-horizontal info-block">
                      <dt><i class="fa fa-info-circle"></i></dt>
                      <dd>
                        Formats autorisés : JPG, GIF, PNG, PDF ou DOC.<br/>
                        Chaque fichier ne doit pas excéder 10MO.
                      </dd>
                    </dl>

                {{ form_widget(form.newDocument, {'attr': {'class': 'form-control'}}) }}

                </div>
              </div>

            </div>
          <div class="row">
              <div class="col-sm-4 col-sm-offset-4">
                  <input type="submit" value="Ajouter le document" class="btn btn-fullcolor form-control">
              </div>
          </div>
        </div>


        <br />

        <div class="row">
            <div class="main col-sm-8 col-sm-offset-2">
                <center>
                    <p>
                        Vous souhaitez vous désinscrire ? Merci d’adresser votre demande à <a href="mailto:contact@plateau-urbain.com">contact@plateau-urbain.com</a>
                    </p>
                </center>
            </div>
        </div>


        </div>
    </div>
    {{ form_end(form) }}
</div>

{% endblock %}

{% block javascript %}

    {% javascripts filter='?yui_js' output='assetic/js/compiled/avocodeformextensions/form-extensions.min.js'
    'bundles/avocodeformextensions/datepicker/js/datepicker.js'
    'bundles/avocodeformextensions/datepicker/js/locales/bootstrap-datepicker.fr.js'
    %}
    <script type="text/javascript" src="{{ asset_url }}"></script>
    {% endjavascripts %}

    <script type="text/javascript">
        function initFormListener() {
            $('input[type="submit"]').click(function(){
                var form = $(this).closest('form');
                var action = form.attr('action');
                var formData = new FormData(form[0]);

                $.ajax({
                    url: action,
                    type: 'POST',
                    data: formData,
                    async: false,
                    success: function (data) {
                        successAjax(data);
                    },
                    cache: false,
                    contentType: false,
                    processData: false
                });

                return false;
            });
        }

        function successAjax(data) {
            $("#js-form-space").html($(data).find('#js-form-space').html()).find('form').addClass('submitted');
            initFormListener();
            $("input[data-provide='datepicker']").datepicker({'format' : 'dd/mm/yyyy', 'language': 'fr'});
            $("select").attr("data-placeholder", "Sélectionnez une option");
            $("select").chosen();
            toggleIdFiles();

            if($('.form-group.has-error').length > 0 || $('.help-block').length > 0) {
              $.colorbox({html:$('#errorBox').html()});
            }
        }

        $(document).ready(function() {
            initFormListener();

            $(document).on('change', '.idcard-file input[type=file], .kbis-file input[type=file]', function(){
              $(this).parents('.form-contener').find('input[type="submit"]').trigger('click');
            });
        });
    </script>

    <div id="errorBox" style="display: none;">
        <div class="colorBox-content">
            <i class="fa fa-info-circle danger"></i>
            <p>Il manque des informations obligatoires pour enregistrer votre profil.</p>
        </div>
    </div>

{% endblock %}

{% block stylesheets %}
    {{ parent() }}

    {% stylesheets filter='cssrewrite,?yui_css' output='assetic/css/compiled/avocodeformextensions/form-extensions.min.css'
    'bundles/avocodeformextensions/datepicker/css/datepicker.css'
    %}
    <link rel="stylesheet" href="{{ asset_url }}" type="text/css" media="all" />
    {% endstylesheets %}
{% endblock %}
